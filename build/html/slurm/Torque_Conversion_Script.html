
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Purpose &#8212; DEAC Cluster Wiki  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><strong>TOC</strong></p>
<div class="section" id="purpose">
<h1>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>This script exists to convert Legacy Torque pbs scripts to SLURM
batch scripts</p></li>
</ul>
</div>
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>To convert a legacy Torque script to a SLURM batch script</p></li>
<li><p>Log into any SLURM head node, and the script is part of the default
$PATH</p></li>
</ul>
<p>:* Provide the path to the file for the input [<strong>-i</strong>]</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1"># pbs2slurm.py -i ./path/to/file1.pbs</span>
</pre></div>
</div>
<p>:* To change the file name besides &lt;input_file&gt;.slurm</p>
<p>::* Provide the desired output filepath/name for the output [<strong>-o</strong>]</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1"># pbs2slurm.py -i ./path/to/file1.pbs -o ./output/NEWFILE.slurm</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>To convert multiple legacy Torque scripts to SLURM batch scripts</p></li>
</ul>
<p>:* Specify multiple filepaths (space delimited) or a directory path for
the input
[<strong>-i</strong>]</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1"># pbs2slurm.py -i ./path/to/file1.pbs ./path/to/file2.pbs ./path/to/file3.pbs</span>
</pre></div>
</div>
<ul class="simple">
<li></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">-</span>
    <span class="n">OR</span>
</pre></div>
</div>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1"># pbs2slurm.py -i ./path/to/files/</span>
</pre></div>
</div>
<p>:* To change the output from default, a directory MUST be specified for
the output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1"># pbs2slurm.py -i ..... -o ./output/path/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Preview conversion changes</p></li>
</ul>
<p>:* Run the script as you normally would, but include the [<strong>-p</strong>]
option</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pbs2slurm.py  -i ./pbs_jobs/torqur_script.pbs -o ./ -p
PREVIEW: ./torque_script.pbs.slurm
#SBATCH --partition=test
#SBATCH --output=&quot;JOB.o&quot;
#SBATCH --error=&quot;JOB.e&quot;
#SBATCH --account=&quot;adminGrp&quot;
#SBATCH --mail-user=arteca9@wfu.edu
#SBATCH --constraint=&quot;ethernet&quot;
#SBATCH --time=0-100:00:00
# Note: SLURM has no batch input for cputime, excluding.
#SBATCH --mem=50gb
#SBATCH --job-name=&quot;convert_torque_script&quot;
#SBATCH --mem-per-cpu=50gb
#NOTE:SLURM defaults to running jobs in the directory where submitted; check functionality!
cd $SLURM_SUBMIT_DIR
SCRATCH=/scratch/$SLURM_JOBID
</pre></div>
</div>
<p>:*To see the entire script output in preview mode, include the
[<strong>-v</strong>] option</p>
</div>
<div class="section" id="typical-required-fixes">
<h1>Typical Required Fixes<a class="headerlink" href="#typical-required-fixes" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Partition should be changed from “debug”</p></li>
</ul>
<p>:* This is the default partition the conversion script assigns, you
should replace it with your desired partition</p>
<ul class="simple">
<li><p>Infiniband job submission</p></li>
</ul>
<p>:* Remove any infiniband constraints, assign the job to the
“infiniband” partition, and add the “switches=1” directive</p>
<ul class="simple">
<li><p>Multiple “constraint” directives are present</p></li>
</ul>
<p>:* Because SLURM can apply and/or logic to constraints, only one entry
should be present</p>
<p>:* Furthermore, some constraints required previously in Torque are no
longer necessary or present (like the “infiniband” constraint)</p>
<p>:* Combine them to a single line, use the
[<a class="reference external" href="https://computing.llnl.gov/linux/slurm/sbatch.html#OPT_constraint">https://computing.llnl.gov/linux/slurm/sbatch.html#OPT_constraint</a>|
SLURM constraint manpage] for guidance</p>
<ul class="simple">
<li><p>The title “JOB” will be applied to your output files.</p></li>
</ul>
<p>:* This is due to the nature in which the script scans the file for
conversion</p>
<p>:* If it appeared first, the job name would be able to be extrapolated
and inserted into the log file name</p>
<p>:* Replace the word “JOB” with your job-name to follow best practices</p>
<ul class="simple">
<li><p>Memory directive change for multi-node jobs</p></li>
</ul>
<p>:* The SLURM memory directive is defined on a <strong>per node</strong> basis,
whereas Torque memory entries are based on the sum total.</p>
<p>:* For multinode jobs, the previous value must be divided by the number
of nodes requested</p>
<p>:* For example, a previously existing 200gb entry for a 5 node job,
will equate to a 40gb per node requirement in SLURM</p>
<p>:** –mem=40gb</p>
</div>
<div class="section" id="script-help">
<h1>Script Help<a class="headerlink" href="#script-help" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>The slurm conversion script uses the argparse module to accept
script input</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># pbs2slurm.py -h</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">pbs2slurm</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="o">-</span><span class="n">i</span> <span class="n">INPUT</span> <span class="p">[</span><span class="n">INPUT</span> <span class="o">...</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OUTPUT</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span>

<span class="n">Script</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">Torque</span> <span class="n">batch</span> <span class="n">scripts</span> <span class="n">to</span> <span class="n">SLURM</span> <span class="n">batch</span> <span class="n">scripts</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">INPUT</span> <span class="p">[</span><span class="n">INPUT</span> <span class="o">...</span><span class="p">],</span> <span class="o">--</span><span class="nb">input</span> <span class="n">INPUT</span> <span class="p">[</span><span class="n">INPUT</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">Input</span> <span class="n">directory</span><span class="o">/</span><span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">to</span> <span class="n">be</span> <span class="n">converted</span><span class="o">.</span> <span class="n">Note</span><span class="p">:</span> <span class="n">Only</span>
                        <span class="n">converts</span> <span class="n">file</span><span class="s1">&#39;s with extensions &#39;</span><span class="o">.</span><span class="n">pbs</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">SC</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUTPUT</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">OUTPUT</span>
                        <span class="n">Output</span> <span class="n">directory</span><span class="o">/</span><span class="n">file</span> <span class="k">for</span> <span class="n">converted</span> <span class="n">files</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span>
                        <span class="n">Default</span><span class="p">:</span> <span class="n">Create</span> <span class="n">output</span> <span class="n">file</span> <span class="k">with</span> <span class="n">same</span> <span class="n">name</span> <span class="k">as</span>
                        <span class="n">converted</span> <span class="n">plus</span> <span class="s1">&#39;.slurm&#39;</span> <span class="n">extension</span>
  <span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="o">--</span><span class="n">preview</span>         <span class="n">Only</span> <span class="n">show</span> <span class="n">converted</span> <span class="n">directives</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">,</span> <span class="n">no</span> <span class="n">files</span>
                        <span class="n">created</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Show</span> <span class="n">non</span><span class="o">-</span><span class="n">converted</span> <span class="n">files</span><span class="p">,</span> <span class="n">preview</span> <span class="n">entire</span> <span class="n">script</span><span class="p">,</span> <span class="ow">and</span>
                        <span class="n">see</span> <span class="n">directory</span> <span class="n">information</span><span class="o">.</span>
</pre></div>
</div>
<p><a class="reference external" href="Category:SLURM">Category:SLURM</a></p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">DEAC Cluster Wiki</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Adam Carlson, Cody Stevens, Sean Anderson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/slurm/Torque_Conversion_Script.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>