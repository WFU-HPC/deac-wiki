
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>What is SLURM? &#8212; DEAC Cluster Wiki  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="what-is-slurm">
<h1>What is SLURM?<a class="headerlink" href="#what-is-slurm" title="Permalink to this headline">¶</a></h1>
<p>The SLURM Workload Manager is <em>an open source, fault-tolerant and highly
scalable cluster management and job scheduling system</em>[1] used on the
DEAC cluster. Formerly known as Simple Linux Utility for Resource
Management (aka <strong>SLURM</strong>)[2], it provides three key functions:</p>
<ol class="simple">
<li><p>Allocates exclusive and/or non-exclusive access to resources
(compute nodes) to users for X period of time</p></li>
<li><p>Provides a framework for starting, executing, and monitoring work on
allocated nodes</p></li>
<li><p>Arbitrates contention for resources by managing a queue of pending
jobs</p></li>
</ol>
</div>
<div class="section" id="example-usage">
<h1>Example Usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="training-videos">
<h2>Training Videos<a class="headerlink" href="#training-videos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>SLURM Job-Submission Part 1 - <a class="reference external" href="https://youtu.be/ChcsBE6tJr8?list=PL-g8n27Db1XfPrRvZMBSxK55_lIy39sqZ">Batch Scripts and
Components</a></p></li>
<li><p>SLURM Job-Submission Part 2 -
<a class="reference external" href="https://youtu.be/yjDwCnLTVPk?list=PL-g8n27Db1XfPrRvZMBSxK55_lIy39sqZ">Commands</a></p></li>
<li><p>SLURM Job-Submission Part 3 - <a class="reference external" href="https://youtu.be/awspKUrvRIg?list=PL-g8n27Db1XfPrRvZMBSxK55_lIy39sqZ">Resource
Availability</a></p></li>
</ul>
</div>
<div class="section" id="job-submission">
<h2>Job Submission<a class="headerlink" href="#job-submission" title="Permalink to this headline">¶</a></h2>
<p>This is a trivial example of using a SLURM script to submit a job
consisting of a single program (called <code class="docutils literal notranslate"><span class="pre">hello_world</span></code>). Further details
are in the <em>SLURM Sbatch Guide</em> online,[3] or found on multiple other
college websites.[4] The program prints “hello, world!” to stdout,
and then sleeps for 30 seconds before terminating. We run it
interactively here:</p>
<p><code class="docutils literal notranslate">&#160;&#160; </code><strong><code class="docutils literal notranslate"><span class="pre">[username&#64;headnode]&gt;</span></code></strong><code class="docutils literal notranslate"> <span class="pre">pwd</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">~/Code/Sandbox/trunk/slurm/NiceCode/</span></code>
<code class="docutils literal notranslate">&#160;&#160; </code><strong><code class="docutils literal notranslate"><span class="pre">[username&#64;headnode]&gt;</span></code></strong><code class="docutils literal notranslate"> <span class="pre">./hello_world</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">hello,</span> <span class="pre">world!</span></code></p>
<p>Here’s the job/batch script <strong><code class="docutils literal notranslate"><span class="pre">myjob.slurm</span></code></strong>. The lines starting with
<code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> specify SLURM directives. They are basically glorified
comments as far as the bash script would be concerned, but sbatch
requires them for job submission. Most of them can be specified as
options to the <strong>sbatch</strong> command, which overrides directives within the
script. It’s important to set your email address with “#SBATCH
–mail-user=username&#64;wfu.edu” so that you receive notifications about
your job.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash -l
#SBATCH --partition=medium
#SBATCH --job-name=hello01
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --mail-user=username@wfu.edu
#SBATCH --account=researcherGrp
#SBATCH --nodes=2
#SBATCH --tasks-per-node=8
#SBATCH --mem=4gb
#SBATCH --time=0-00:30:00

$HOME/Code/Sandbox/trunk/slurm/NiceCode/hello_world
</pre></div>
</div>
<p>This sbatch script sets some SLURM-specific variables, and then calls
the actual program <strong>hello_world</strong>. The job is submitted with <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>:</p>
<p><code class="docutils literal notranslate">&#160;&#160; </code><strong><code class="docutils literal notranslate"><span class="pre">[username&#64;headnode]&gt;</span></code></strong><code class="docutils literal notranslate"> <span class="pre">sbatch</span> <span class="pre">myjob.slurm</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">Submitted</span> <span class="pre">batch</span> <span class="pre">job</span> <span class="pre">1234</span></code></p>
</div>
<div class="section" id="test-submission">
<h2>Test Submission<a class="headerlink" href="#test-submission" title="Permalink to this headline">¶</a></h2>
<p>To see if you job will submit successfully, you can use the
<strong>–test-only</strong> flag with sbatch. It will show the approximate start
time, resources used, and node name to be assigned to your
job:</p>
<p><code class="docutils literal notranslate">&#160;&#160; </code><strong><code class="docutils literal notranslate"><span class="pre">[username&#64;headnode]$</span></code></strong><code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">--test-only</span> <span class="pre">./myjob.slurm</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">sbatch:</span> <span class="pre">Job</span> <span class="pre">1234</span> <span class="pre">to</span> <span class="pre">start</span> <span class="pre">at</span> <span class="pre">2016-04-29T15:17:22</span> <span class="pre">using</span> <span class="pre">16</span> <span class="pre">processors</span> <span class="pre">on</span> <span class="pre">bc04bl[06,08]</span></code></p>
</div>
<div class="section" id="job-status">
<h2>Job Status<a class="headerlink" href="#job-status" title="Permalink to this headline">¶</a></h2>
<p>You can check the status of a job with
<code class="docutils literal notranslate"><span class="pre">sacct</span></code>:</p>
<p><code class="docutils literal notranslate">&#160;&#160; </code><strong><code class="docutils literal notranslate"><span class="pre">[username&#64;headnode]&gt;</span></code></strong><code class="docutils literal notranslate"> <span class="pre">sacct</span> <span class="pre">--jobs</span> <span class="pre">1234</span></code>
<code class="docutils literal notranslate">&#160; <span class="pre">JobID</span>&#160;&#160;&#160; <span class="pre">JobName</span>&#160; <span class="pre">Partition</span>&#160;&#160;&#160; <span class="pre">Account</span>&#160; <span class="pre">AllocCPUS</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">State</span> <span class="pre">ExitCode</span></code>
<code class="docutils literal notranslate">&#160; <span class="pre">------------</span> <span class="pre">----------</span> <span class="pre">----------</span> <span class="pre">----------</span> <span class="pre">----------</span> <span class="pre">----------</span> <span class="pre">--------</span></code>
<code class="docutils literal notranslate">&#160; <span class="pre">1234</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">hello_wor_+</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">medium</span>&#160;&#160; <span class="pre">researchgrp</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">1</span>&#160; <span class="pre">COMPLETED</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">0:0</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">1234.batch</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">batch</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">researchgrp</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">1</span>&#160; <span class="pre">COMPLETED</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">0:0</span></code></p>
<p>Check the <a class="reference external" href="SLURM:Commands#sacct">SLURM commands</a> page for
more information on output formatting!</p>
</div>
<div class="section" id="email-messages">
<h2>Email Messages<a class="headerlink" href="#email-messages" title="Permalink to this headline">¶</a></h2>
<p>You should receive an email message when the job
begins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span> <span class="o">&lt;</span><span class="n">hello_world</span><span class="o">&gt;</span> <span class="n">was</span> <span class="n">executed</span> <span class="n">on</span> <span class="n">node</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">compute_node1</span><span class="o">&gt;</span><span class="p">,</span> <span class="ow">in</span> <span class="n">partition</span> <span class="o">&lt;</span><span class="n">partition</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">as</span> <span class="n">user</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="kn">from</span> <span class="nn">group</span> <span class="o">&lt;</span><span class="n">researchgrp</span><span class="o">&gt;.</span>
<span class="n">The</span> <span class="n">initial</span> <span class="n">working</span> <span class="n">directory</span> <span class="n">of</span> <span class="n">this</span> <span class="n">job</span> <span class="n">was</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">Sandbox</span><span class="o">/</span><span class="n">trunk</span><span class="o">/</span><span class="n">slurm</span><span class="o">/</span><span class="n">NiceCode</span><span class="o">/.</span>

<span class="n">Job</span> <span class="n">has</span> <span class="n">started</span> <span class="n">execution</span><span class="o">.</span>

<span class="n">Job</span> <span class="n">Times</span><span class="p">:</span>
<span class="o">=======</span>
    <span class="n">Submitted</span><span class="p">:</span>  <span class="mi">2015</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">09</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">12</span>
    <span class="n">Started</span><span class="p">:</span>    <span class="mi">2015</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">09</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">12</span>


<span class="n">Summary</span> <span class="n">email</span> <span class="n">to</span> <span class="n">be</span> <span class="n">sent</span> <span class="n">upon</span> <span class="n">job</span> <span class="n">completion</span><span class="o">.</span>
</pre></div>
</div>
<p>And then another when the job
completes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span> <span class="o">&lt;</span><span class="n">hello_world</span><span class="o">&gt;</span> <span class="n">was</span> <span class="n">executed</span> <span class="n">on</span> <span class="n">node</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">compute_node1</span><span class="o">&gt;</span><span class="p">,</span> <span class="ow">in</span> <span class="n">partition</span> <span class="o">&lt;</span><span class="n">partition</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">as</span> <span class="n">user</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="kn">from</span> <span class="nn">group</span> <span class="o">&lt;</span><span class="n">researchgrp</span><span class="o">&gt;.</span>
<span class="n">The</span> <span class="n">initial</span> <span class="n">working</span> <span class="n">directory</span> <span class="n">of</span> <span class="n">this</span> <span class="n">job</span> <span class="n">was</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">Sandbox</span><span class="o">/</span><span class="n">trunk</span><span class="o">/</span><span class="n">slurm</span><span class="o">/</span><span class="n">NiceCode</span><span class="o">/.</span>

<span class="n">Job</span> <span class="n">successfully</span> <span class="n">completed</span><span class="o">.</span>

<span class="n">Job</span> <span class="n">Times</span><span class="p">:</span>
<span class="o">=======</span>
    <span class="n">Submitted</span><span class="p">:</span>  <span class="mi">2015</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">09</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">12</span>
    <span class="n">Started</span><span class="p">:</span>    <span class="mi">2015</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">09</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">12</span>
    <span class="n">Ended</span><span class="p">:</span>      <span class="mi">2015</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">09</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">25</span>
    <span class="n">Elapsed</span><span class="p">:</span>    <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">13</span>

<span class="n">Job</span> <span class="n">Resource</span> <span class="n">Usage</span> <span class="n">Summary</span><span class="p">:</span>
<span class="o">======================</span>

    <span class="n">JOB</span> <span class="n">ID</span><span class="p">:</span>   <span class="mi">1234</span>
    <span class="c1"># CPUS:   8</span>
    <span class="c1"># NODES:  2</span>
    <span class="n">MEM</span><span class="o">/</span><span class="n">task</span><span class="p">:</span> <span class="n">n</span><span class="o">/</span><span class="n">a</span>
    <span class="n">JOB</span> <span class="n">Name</span><span class="p">:</span> <span class="n">hello_world</span>

    <span class="n">JOB</span> <span class="n">ID</span><span class="p">:</span>   <span class="mf">6352.</span><span class="n">batch</span>
    <span class="c1"># CPUS:   8</span>
    <span class="c1"># NODES:  2</span>
    <span class="n">MEM</span><span class="o">/</span><span class="n">task</span><span class="p">:</span> <span class="mi">19540</span><span class="n">K</span>
    <span class="n">JOB</span> <span class="n">Name</span><span class="p">:</span> <span class="n">batch</span>


<span class="n">Requested</span> <span class="n">Resources</span> <span class="ow">and</span> <span class="n">Totals</span><span class="p">:</span>
<span class="o">=======================</span>
    <span class="n">Requested</span> <span class="n">time</span> <span class="n">limit</span><span class="p">:</span>  <span class="mi">0</span><span class="o">-</span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>
    <span class="n">Requested</span> <span class="n">memory</span><span class="p">:</span>      <span class="mi">4</span><span class="n">G</span> <span class="p">(</span><span class="n">per</span> <span class="n">Node</span><span class="p">)</span>
    <span class="n">Total</span> <span class="n">CPU</span> <span class="n">time</span> <span class="p">:</span>       <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">13</span>
    <span class="n">Total</span> <span class="n">Allocated</span> <span class="n">CPUs</span><span class="p">:</span>  <span class="mi">8</span>
    <span class="n">Total</span> <span class="n">Allocated</span> <span class="n">Nodes</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Permalink to this headline">¶</a></h2>
<p>When the job completes, by default there is one output file created in
the working path when the job was submitted: <strong>slurm-<jobid>.out</strong>. This
file will contain data written to <em>stdout</em> (printed output messages) and
<em>stderr</em> (generated error messages) information. To change this default
action and create separate files, use the following directives:</p>
<p>Create a starndard output file with whichever name you desire (best
practice - include the job name), and containing job id:</p>
<p><code class="docutils literal notranslate">&#160; <span class="pre">#SBATCH</span> <span class="pre">--output=&quot;hello_world-%j.o&quot;</span></code></p>
<p>Create a standard error file with whichever name you desire, and
containing job id:</p>
<p><code class="docutils literal notranslate">&#160; <span class="pre">#SBATCH</span> <span class="pre">--error=&quot;hello_world-%j.e&quot;</span></code></p>
<p>These files are also created by default in the working path when the job
was submitted. To change the path where the file is created, add the
following directive to your batch script.</p>
<p><code class="docutils literal notranslate">&#160; <span class="pre">#SBATCH</span> <span class="pre">--workdir=&quot;</span></code><PATH><code class="docutils literal notranslate"><span class="pre">&quot;</span></code></p>
<p>The job output file(s) will then be created in that specified workdir
path.</p>
</div>
</div>
<div class="section" id="job-submission-details">
<h1>Job Submission Details<a class="headerlink" href="#job-submission-details" title="Permalink to this headline">¶</a></h1>
<p>A job script is a normal script. It can be a shell script (bash, tcsh,
sh, csh, zsh) or even any other scripting language (Perl, Python, etc).
SLURM will set environment variables before executing the script, and
the job script has access to these environment variables. If your script
is not a shell script, then you would have to use the script language
features to get access to the environment variables.</p>
<p>A job script may consist of SBATCH directives, comments, and executable
statements. SBATCH directives – lines beginning with “<strong>#SBATCH</strong>” –
specify job attributes as well as (sbatch) command line options. Lines
where the first non-whitespace character is “<code class="docutils literal notranslate"><span class="pre">#</span></code>” are comments (other
than the “<code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code>” lines).</p>
<p>When a job script is submitted with sbatch, it parses the script for
#SBATCH directives. These directives correspond to sbatch command line
options; any directive given via command line during submission will
override matching directives within the job script.</p>
<div class="section" id="convert-torque-scripts-to-slurm">
<h2>Convert Torque Scripts to SLURM<a class="headerlink" href="#convert-torque-scripts-to-slurm" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="SLURM:Torque_Conversion_Script">SLURM:Torque Conversion
Script</a> page for how to
convert your legacy Torque scripts.</p>
</div>
<div class="section" id="slurm-to-torque-equivalent-commands">
<h2>SLURM to Torque Equivalent Commands<a class="headerlink" href="#slurm-to-torque-equivalent-commands" title="Permalink to this headline">¶</a></h2>
<p>See the “<a class="reference external" href="SLURM:Torque_Command_Equivalents">SLURM:Torque Command
Equivalents</a>” page to
quickly lookup SLURM equivalents to your legacy Torque commands.</p>
</div>
<div class="section" id="sample-slurm-job-script-templates">
<h2>Sample SLURM Job Script Templates<a class="headerlink" href="#sample-slurm-job-script-templates" title="Permalink to this headline">¶</a></h2>
<p>See “<a class="reference external" href="SLURM:Job_Script_Templates">SLURM:Job Script
Templates</a>” for several templates
for typical usage.</p>
</div>
<div class="section" id="sbatch">
<h2>sbatch<a class="headerlink" href="#sbatch" title="Permalink to this headline">¶</a></h2>
<p>There are many sbatch options, all of which may be put into the SLURM
batch script with “#SBATCH” directives. This helps you avoid typing
long sbatch commands. See the sbatch man page for complete details. Look
at the for the <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">sbatch</a> online
documentation, or on command line by running <strong>sbatch -h</strong>. You can run
sbatch with the <strong>–test-only</strong> parameter to test syntax and logic of
your directives and determine if submission would be successful. Another
helpful resource is the official SLURM cheatsheet[5]. NOTE that
<strong>srun</strong> usage is not normally used on the cluster.</p>
</div>
<div class="section" id="requesting-resources">
<h2>Requesting Resources<a class="headerlink" href="#requesting-resources" title="Permalink to this headline">¶</a></h2>
<p>Within SLURM, CPU and Memory are used as consumable resources. This
means that when these resources are requested, they are the primary
deciding factor in node assignment. CPU specifies the number of cores,
and memory specifies the amount of RAM required. Jobs should also
specify the number of nodes and time required. All resource requests
should be explicitly listed within the job script using the #SBATCH
directive. More details on consumable resources are in SLURM
documentation
online.[6]</p>
<p><code class="docutils literal notranslate">&#160;&#160; <span class="pre">#</span> <span class="pre">Example</span> <span class="pre">of</span> <span class="pre">requesting</span> <span class="pre">16</span> <span class="pre">total</span> <span class="pre">CPUS</span> <span class="pre">across</span> <span class="pre">2</span> <span class="pre">nodes,</span> <span class="pre">with</span> <span class="pre">32</span> <span class="pre">GB</span> <span class="pre">of</span> <span class="pre">memory,</span> <span class="pre">to</span> <span class="pre">run</span> <span class="pre">for</span> <span class="pre">24</span> <span class="pre">hours</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">#SBATCH</span> <span class="pre">--nodes=2</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">#SBATCH</span> <span class="pre">--tasks-per-node=8</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">#SBATCH</span> <span class="pre">--mem=32gb</span></code>
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">#SBATCH</span> <span class="pre">--time=24:00:00</span></code></p>
<p>Every node sets aside 1 GB of RAM for system use, so the amount
available for user jobs is less than the total installed RAM. This means
that, if your job requires less than 96 GB of RAM, it is better to
request &lt;= 95 GB. This is because there are nodes with 96 GB of RAM
installed, and requesting exactly 96 GB means the job will not run on
these otherwise available nodes.</p>
<p>Also, there is no consideration for CPU Time within SLURM, all time
estimates should be based on actual run time (walltime) only.</p>
</div>
<div class="section" id="partitions">
<h2>Partitions<a class="headerlink" href="#partitions" title="Permalink to this headline">¶</a></h2>
<p>Partitions are used within SLURM to provide additional weight for job
types allocated on the DEAC cluster. To specify a partition, use the
following directive:</p>
<p><code class="docutils literal notranslate">&#160;&#160; <span class="pre">#SBATCH</span> <span class="pre">--partition=</span></code><NAME></p>
<p>A partition must be specified to run jobs on the cluster, the default
partition is not designed to work outside of testing. See
<a class="reference external" href="SLURM:Resources#Partitions">SLURM:Resources#Partitions</a> for
a full list of available SLURM partitions to submit jobs to.</p>
</div>
<div class="section" id="scratch-disk-space">
<h2>Scratch Disk Space<a class="headerlink" href="#scratch-disk-space" title="Permalink to this headline">¶</a></h2>
<p>For jobs which do a lot of disk i/o, it may be advantageous to use a
local disk during execution. Local disk i/o is much faster than network
disk i/o. Every compute node has at least 40GB of scratch disk space on
a local disk, with newer nodes having 250GB. A constraint can be used to
specify desired scratch space availability on nodes.</p>
<p>When a job starts up on a compute node, a scratch directory is
automatically created in <code class="docutils literal notranslate"><span class="pre">/scratch/$SLURM_JOBID</span></code>. Make sure to write
your job scripts to use that directory as scratch space. If you need
more scratch disk space than available, you can A) Reduce the job output
and run into smaller chunks, B) Intermittently clean up output in
scratch space, or C) Use your research data directory. Option C will
incur a performance penalty as disk i/o over the network is slower than
local disk i/o.</p>
<p><strong>IMPORTANT</strong>: DO NOT use your home directory for writing out files
created during a run, especially if there is a lot of data and/or a lot
of files. This will be slow for your job, and will cause interactive
sessions on the head node to slow down, too. To prevent slow down,
admins may terminate suspect jobs that are actively performing many
read/writes to home directories.</p>
<p>Please see <a class="reference external" href="Quick_Start_Guide:Disk_Space">Quick Start Guide:Disk
Space</a> for more information.</p>
</div>
<div class="section" id="permissions-of-output-files">
<h2>Permissions of Output Files<a class="headerlink" href="#permissions-of-output-files" title="Permalink to this headline">¶</a></h2>
<p>Files created by the job script (not the output file(s) mentioned
<a class="reference external" href="SLURM:Quick_Start_Guide#Output_Files">previously</a> are
created by default with permissions of 775 (people in your group can
read and write; everyone else can read) that only allow the owner to
read them. To make it so only you can access files created by your
script, insert the following after the directives in your job script:</p>
<p><code class="docutils literal notranslate">&#160;&#160; <span class="pre">umask</span> <span class="pre">0077</span></code></p>
<p>SLURM also has a built in variable, SLURM_UMASK, but it does not
function properly at this time. If you want your output files to be
accessable by your group, but not to everyone else, insert the following
after the directives in your job script:</p>
<p><code class="docutils literal notranslate">&#160;&#160; <span class="pre">umask</span> <span class="pre">0027</span></code></p>
</div>
<div class="section" id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>SLURM has two types of environment variables. INPUT environment
variables[7] are read and used during execution; they override options
set in the batch script, but command line options override any
environment variables. OUTPUT environment variables[8] are set by the
controller daemon, and can not be overridden in a batch script. Both
types contain information about the runtime environment, e.g. the
working directory, the node on which it is running, etc. See the
referenced source pages for more information.</p>
</div>
<div class="section" id="slurm-constraints">
<h2>SLURM constraints<a class="headerlink" href="#slurm-constraints" title="Permalink to this headline">¶</a></h2>
<p>When running parallel processing jobs, users typically will want all of
the nodes assigned to the job to be similar (e.g. on the same chassis).
In most cases, it doesn’t matter which chassis the job is run on so long
as all the nodes are in the same one.</p>
<p>This scenario requires the use of SLURMs constraint functionality.
Constraints are matched against a nodes’ assigned features, which are
dependent upon a node’s <strong><a class="reference external" href="Cluster:Hardware_Configuration#SLURM_Node_Features">Hardware
Configuration</a></strong>.
To use the constraint function, simply include one of the following line
within your script:</p>
<ul class="simple">
<li><p>Single flag</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --constraint=&quot;x&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Multiple flags allowed</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --constraint=&quot;x|y|z&quot;</span>
<span class="c1">###This allows different constraints to be selected across multiple nodes</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Matching Multiple flags</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --constraint=&quot;[x|y|z]&quot;</span>
<span class="c1">###This matches a singular constraint against all selected nodes</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Multiple flags required</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --constraint=[x&amp;y&amp;z]</span>
<span class="c1">###This requires all constraint listed to be present for a node to be selected</span>
</pre></div>
</div>
</div></blockquote>
<p>When using constraints, be careful not to require groupings of
constraints that do not exist. For example, do not require
[broadwell&amp;haswell] as that does not exist; meaning the jobs will
never run.</p>
</div>
<div class="section" id="job-chaining-and-dependencies">
<h2>Job Chaining and Dependencies<a class="headerlink" href="#job-chaining-and-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Job execution can be dependent on other jobs completing (successfully or
not). This dependency feature is an advanced capability requires
submitting a job that references an existing job on which to be
dependent
via:</p>
<p><code class="docutils literal notranslate">&#160;&#160; <span class="pre">sbatch</span> <span class="pre">--dependency=</span></code><AFTER><code class="docutils literal notranslate"><span class="pre">:</span></code>&lt;JOB_ID&gt;<code class="docutils literal notranslate"><span class="pre">[:</span></code>&lt;JOB_ID&gt;<code class="docutils literal notranslate"><span class="pre">...]</span> <span class="pre">&lt;mywaitingjob.slurm&gt;</span></code></p>
<p>Along with the <em>&lt;JOB_ID&gt;</em> to depend on, an ‘<AFTER>’ clause must be
included. Those options are:</p>
<ul class="simple">
<li><p>after - Can begin after the specified job starts running</p></li>
<li><p>afterok - Can begin running after the specified jobs ends
successfully</p></li>
<li><p>afternotok - Can begin running after the specified job ends with
failure</p></li>
<li><p>afterany - Can begin running after specified job ends, regardless of
status.</p></li>
</ul>
<p>A job can have multiple JOB_IDs that it depends upon, which are
delimited with a colon. Dependencies are usually used within job chains,
which are long sequences of small jobs that run sequentially. A simple
bash script example that creates a singular job chain is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

FIRST=$(sbatch --parsable $1)
COUNTER=1
while [ $COUNTER -lt $2 ]; do
   SECOND=$(sbatch --parsable --dependency=afterany:$FIRST $1)
   let COUNTER=COUNTER+1
   FIRST=$SECOND
done
</pre></div>
</div>
<p>The above example requires two input parameters to create a job chain.</p>
<ol class="simple">
<li><p>Path to the job file to execute: “myscript.slurm”</p></li>
<li><p>An integer representing the number of dependent iterations: “100”</p></li>
</ol>
</div>
<div class="section" id="job-arrays">
<h2>Job Arrays<a class="headerlink" href="#job-arrays" title="Permalink to this headline">¶</a></h2>
<p>Job arrays used to start more than one job with a single job script
submission. The –array directive must be used to create an array Job
arrays will have two additional environment variabels set.
<strong>SLURM_ARRAY_JOB_ID</strong>, which is set to the first job ID of the
array, and <strong>SLURM_ARRAY_TASK_ID</strong>, which is the index value for that
job. Essentially, the “SLURM_JOBID” environment variable will only
match the “SLURM_ARRAY_JOB_ID” of the first job. To create output an
output file containing the assigned Array JOB_ID value with special
environment variables, define the output directive as follows within
your job:</p>
<p><code class="docutils literal notranslate">&#160; <span class="pre">#SBATCH</span> <span class="pre">--output=JOB_NAME-%A_%a.o</span></code></p>
<p>The <strong>%A</strong> will automatically inherit the <strong>SLURM_JOBID</strong> if used
outside of an array; whereas <strong>%a</strong> will be assigned “4,294,967,294
(equivalent to 0xfffffffe or NO_VAL) if used. Please see the <a class="reference external" href="http://slurm.schedmd.com/job_array.html">Official
Slurm Job Array Support</a>
article for more in depth information.</p>
</div>
<div class="section" id="interactive-jobs">
<h2>Interactive Jobs<a class="headerlink" href="#interactive-jobs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Though batch submission is the recommended way to submit jobs to the
cluster</p></li>
<li><p>Interactive jobs can also be run in the foreground, which can be
useful for things like:</p>
<ul>
<li><p>Iterative data exploration at the command line</p></li>
<li><p>RAM intensive graphical applications like MATLAB or SAS.</p></li>
<li><p>Interactive “console tools” like R and iPython</p></li>
</ul>
</li>
<li><p>Interactive jobs can be submitted using the <strong>srun</strong> command with
the <strong>–pty</strong> option</p>
<ul>
<li><p>The below example will open a bash command line shell on a node
for 6 hours with 2GB of RAM.</p>
<ul>
<li><p>The –pty option allows the session to act like a standard
terminal on the assigned</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">srun</span> <span class="o">-</span><span class="n">p</span> <span class="n">small</span> <span class="o">--</span><span class="n">pty</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="o">--</span><span class="n">mem</span><span class="o">=</span><span class="mi">64</span><span class="n">G</span> <span class="o">--</span><span class="n">time</span><span class="o">=</span><span class="mi">6</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">--</span><span class="n">reservation</span><span class="o">=</span><span class="n">x11_2</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="x11-forwarding">
<h2>X11 forwarding<a class="headerlink" href="#x11-forwarding" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Interactive srun jobs can submit <strong>–x11=[first|last|all]</strong> to
enable</p></li>
</ul>
<blockquote>
<div><p>forwarding</p>
</div></blockquote>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">srun</span> <span class="o">-</span><span class="n">p</span> <span class="n">small</span> <span class="o">--</span><span class="n">pty</span> <span class="o">--</span><span class="n">x11</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="o">--</span><span class="n">mem</span> <span class="mi">4000</span> <span class="o">-</span><span class="n">t</span> <span class="mi">0</span><span class="o">-</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">i</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="job-states">
<h1>Job States<a class="headerlink" href="#job-states" title="Permalink to this headline">¶</a></h1>
<p>A job may have one of several states during its lifetime. If you run
<strong>squeue -l</strong>, the job state is reported as <em>STATE</em>, in its full or
abbreviated name. See <a class="reference external" href="http://slurm.schedmd.com/squeue.html#lbAG">Official Slurm Listing of Job State
Codes</a> for the full listing
of states, below are the most common you will see on our cluster:</p>
<ul class="simple">
<li><p>CANCELLED (CA) : Job was explicitly cancelled by the user or system
administrator. The job may or may not have been initiated.
COMPLETED (CD) : Job has terminated all processes on all nodes.
FAILED (F) : Job terminated with non-zero exit code or other failure
condition.
NODE_FAIL (NF) : Job terminated due to failure of one or more
allocated nodes.
PENDING (PD) : Job is awaiting resource allocation.
RUNNING (R) : Job currently has an allocation.</p></li>
</ul>
</div>
<div class="section" id="querying-the-cluster">
<h1>Querying the Cluster<a class="headerlink" href="#querying-the-cluster" title="Permalink to this headline">¶</a></h1>
<p>SLURM provides several commands which allow you to query the state of
the queue, the state of a partition, the state of your job, or the state
of the compute nodes. Some officially supported plugins are available
and installed on the cluster to provide even more command line options.
Some of which are designed to replicate output of previously used Torque
commands. See the [<a class="reference external" href="https://github.com/ubccr/stubl">https://github.com/ubccr/stubl</a>| official STUBL
support page] for more information.</p>
<div class="section" id="job-information">
<h2>Job information<a class="headerlink" href="#job-information" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>squeue [–start –job <JOBID>]
Use this command to query the list of jobs currently running and
queued on the cluster
Use the optional input to determine estimated start time and node(s)
for a job</p></li>
<li><p>scontrol show job JOB_ID
Show detailed information about an active job</p></li>
<li><p>sinfo –jobs=<JOBID> [<JOBID> etc]
Show detailed information about a completed job</p></li>
</ul>
</div>
<div class="section" id="changing-jobs">
<h2>Changing jobs<a class="headerlink" href="#changing-jobs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>NOTE: you can only modify your own job</p></li>
<li><p>scontrol update JobID=<JOBID> TimeLimit=d-hh:mm:ss
Change wall time of a job to d-hh:mm:ss</p></li>
<li><p>scancel <JOBID>
Terminate a queued or running job</p></li>
</ul>
</div>
<div class="section" id="partition-information">
<h2>Partition information<a class="headerlink" href="#partition-information" title="Permalink to this headline">¶</a></h2>
<p>For information on partitions, visit the
<a class="reference external" href="SLURM:Resources#Partitions">SLURM:Resources#Partitions</a>
page.</p>
<p>Commands used to query nodse and gather partition information is as
followS:</p>
<ul class="simple">
<li><p>sinfo -p <partition>
Queries the specified partition</p></li>
<li><p>sinfo –long –Node –summarize
Shows an overall listing of nodes sorted by partition</p></li>
<li><p>scontrol show partition [<partition>]
Show detailed information for all or specified partition</p></li>
<li><p>spinfo (STUBL)
Custom designed output for partition information</p></li>
</ul>
</div>
<div class="section" id="node-information">
<h2>Node information<a class="headerlink" href="#node-information" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>sinfo -Nel
Shows an overall listing of nodes, sorted by nodes</p></li>
<li><p>sinfo -t idle
Show only idle nodes</p></li>
<li><p>scontrol show nodes [<node>]
Shows hardware details for all or specified node, including features</p></li>
<li><p>snodes (STUBL)
Displays node information in an easy-to-interpret format</p></li>
</ul>
</div>
</div>
<div class="section" id="matlab-jobs">
<h1>Matlab Jobs<a class="headerlink" href="#matlab-jobs" title="Permalink to this headline">¶</a></h1>
<p>To submit Matlab to the queue, please see
<a class="reference external" href="Software:Matlab">Software:Matlab</a></p>
</div>
<div class="section" id="see-also">
<h1>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="SLURM:Job_Script_Templates">SLURM:Job Script Templates</a></p></li>
<li><p><a class="reference external" href="SLURM:Resources">SLURM:Resources</a></p></li>
<li><p><a class="reference external" href="SLURM:Troubleshooting">SLURM:Troubleshooting</a></p></li>
<li><p><a class="reference external" href="http://slurm.schedmd.com/troubleshoot.html">Troubleshooting</a> on the
official SLURM support page</p></li>
<li><p><a class="reference external" href="http://slurm.schedmd.com/faq.html">FAQ</a> on the official SLURM
support page</p></li>
<li><p><a class="reference external" href="https://confluence.csiro.au/download/attachments/342229594/SLURM.pdf?version=1&amp;modificationDate=1466993467567&amp;api=v2">Unofficial SLURM Cheat
Sheet</a>
(pdf document)</p></li>
<li><p><a class="reference external" href="Cluster:Hardware_Configuration#SLURM_Node_Features">SLURM Node
Features</a>
– specify nodes that you want for your job by their specific
features</p></li>
</ul>
</div>
<div class="section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<references/><p><a class="reference external" href="Category:Quick_Start">Category:Quick Start</a>
<a class="reference external" href="Category:SLURM">Category:SLURM</a>
<a class="reference external" href="Category:Software">Category:Software</a></p>
<ol class="simple">
<li><p><a class="reference external" href="http://slurm.schedmd.com/quickstart.html">SLURM Quickstart Guide</a>
at Department of Energy’s National Nuclear Security Administration</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Slurm_Workload_Manager">Slurm Workload Manager
article</a> at
Wikipedia</p></li>
<li><p><a class="reference external" href="http://slurm.schedmd.com/sbatch.html">Job Submission</a> under
<em>OPTIONS</em></p></li>
<li><p>Google Search
<a class="reference external" href="https://www.google.com/search?q=slurm+sbatch+edu+examples&amp;oq=slurm+sbatch+edu+examples">1</a>;
or type sbatch –help on the command line</p></li>
<li><p><a class="reference external" href="https://slurm.schedmd.com/pdfs/summary.pdf">SLURM Cheat Sheet</a></p></li>
<li><p><a class="reference external" href="http://slurm.schedmd.com/cons_res.html#Consumable">Resources in
SLURM</a></p></li>
<li><p><a class="reference external" href="http://slurm.schedmd.com/sbatch.html#lbAF">Sbatch Input Variables</a>
at SchedMD</p></li>
<li><p><a class="reference external" href="http://slurm.schedmd.com/sbatch.html#lbAG">Sbatch Output Variables</a>
at SchedMD</p></li>
</ol>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">DEAC Cluster Wiki</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Adam Carlson, Cody Stevens, Sean Anderson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/slurm/Quick_Start_Guide.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>