
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>R Language &#8212; DEAC Cluster Wiki  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="r-language">
<h1><em><strong>R Language</strong></em><a class="headerlink" href="#r-language" title="Permalink to this headline">¶</a></h1>
<p><strong>forcetoc</strong></p>
<div class="section" id="description-info">
<h2>Description &amp; Info<a class="headerlink" href="#description-info" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>R is a statistical programming language.</p></li>
<li><p>The <a class="reference external" href="Software:RStudio">Software:RStudio</a> IDE can be used
on any head-node.</p></li>
<li><p>Using R in a Parallel and Distributed cluster, the <strong>Rmpi</strong> package
must be used.</p></li>
<li><p><a class="reference external" href="Software:RStudio#Installing_Packages_%27%27%27Rmpi%27%27%27_package_installation">Software:RStudio#Installing_Packages <strong>Rmpi</strong> package
installation</a></p></li>
<li><p>Wikibook: <a class="reference external" href="http://en.wikibooks.org/wiki/R_Programming">R
Programming</a></p></li>
<li><p><a class="reference external" href="http://cran.r-project.org/web/views/HighPerformanceComputing.html">HPC with
R</a></p></li>
</ul>
</div>
</div>
<div class="section" id="testing-rmpi-package">
<h1><em><strong>Testing Rmpi Package</strong></em><a class="headerlink" href="#testing-rmpi-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="hello-world-r-mpi">
<h2>Hello World R/MPI<a class="headerlink" href="#hello-world-r-mpi" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>One way to test the <strong>Rmpi</strong> package on the cluster, is to run a
classic <strong>MPI Hello World</strong> from the spawned process</p></li>
<li><p>The code from <a class="reference external" href="http://math.acadiau.ca/ACMMaC/Rmpi/sample.html">Acadia
University</a> in
Canada is used</p></li>
<li><p>Template:</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>library(Rmpi)

if (!is.loaded(&quot;mpi_initialize&quot;)) {
  library(&quot;Rmpi&quot;)
}
mpi.spawn.Rslaves()

.Last &lt;- function(){
  if(is.loaded(&quot;mpi_initialize&quot;)) {
    if(mpi.comm.size(1)&gt;0) {
      print(&quot;Please use mpi.close.Rslave() to close slaves.&quot;)
      mpi.close.Rslaves()
    }
    print(&quot;Please use mpi.quit() to quit R&quot;)
    .Call(&quot;mpi_finalize&quot;)
  }
}

mpi.remote.exec(paste(&quot;I am&quot;,mpi.comm.rank(),&quot;of&quot;,mpi.comm.size()))
mpi.close.Rslaves()
mpi.quit()
</pre></div>
</div>
</div>
<div class="section" id="job-script-template">
<h2>Job Script template<a class="headerlink" href="#job-script-template" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The template is a basic script</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="c1">#SBATCH --job-name=&quot;name_of_job&quot;</span>
<span class="c1">#SBATCH --partition=debug</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=8</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --partition=debug</span>
<span class="c1">#SBATCH --time=0-00:01:00</span>
<span class="c1">#SBATCH --mail-type=BEGIN</span>
<span class="c1">#SBATCH --output=&quot;name_of_job-%j.o&quot;</span>
<span class="c1">#SBATCH --error=&quot;name_of_job-%j.e&quot;</span>
<span class="c1">#SBATCH --mail-user=email@wfu.edu</span>
<span class="c1">#SBATCH --account=&quot;FAIRSHAREGrp&quot;</span>

<span class="n">module</span> <span class="n">load</span> <span class="n">openmpi</span><span class="o">/</span><span class="mf">1.6</span><span class="o">-</span><span class="n">intel</span>

<span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">the</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">file</span>
<span class="n">R</span> <span class="o">--</span><span class="n">vanilla</span> <span class="o">&lt;</span><span class="n">name_of_script</span><span class="o">.</span><span class="n">R</span> <span class="o">&gt;</span><span class="n">output_file</span><span class="o">.</span><span class="n">out</span>
<span class="n">exit</span> <span class="mi">0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Send job: <strong>sbatch</strong> name_of_script_file</p></li>
<li><p>It will take 3 seconds to finish the job</p></li>
</ul>
</div>
<div class="section" id="output-file-out">
<h2>Output_File.OUT<a class="headerlink" href="#output-file-out" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The output that is expected from the R program</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R version 3.1.0 (2014-04-10) -- &quot;Spring Dance&quot;
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-redhat-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type &#39;license()&#39; or &#39;licence()&#39; for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type &#39;contributors()&#39; for more information and
&#39;citation()&#39; on how to cite R or R packages in publications.

Type &#39;demo()&#39; for some demos, &#39;help()&#39; for on-line help, or
&#39;help.start()&#39; for an HTML browser interface to help.
Type &#39;q()&#39; to quit R.

&gt; library(Rmpi)
&gt;
&gt; if (!is.loaded(&quot;mpi_initialize&quot;)) {
+   library(&quot;Rmpi&quot;)
+ }
&gt; mpi.spawn.Rslaves()
        1 slaves are spawned successfully. 0 failed.
master (rank 0, comm 1) of size 2 is running on: bc02bl03
slave1 (rank 1, comm 1) of size 2 is running on: bc02bl03
&gt;
&gt; .Last &lt;- function(){
+   if(is.loaded(&quot;mpi_initialize&quot;)) {
+     if(mpi.comm.size(1)&gt;0) {
+       print(&quot;Please use mpi.close.Rslave() to close slaves.&quot;)
+       mpi.close.Rslaves()
+     }
+     print(&quot;Please use mpi.quit() to quit R&quot;)
+     .Call(&quot;mpi_finalize&quot;)
+   }
+ }
&gt;
&gt; mpi.remote.exec(paste(&quot;I am&quot;,mpi.comm.rank(),&quot;of&quot;,mpi.comm.size()))
$slave1
[1] &quot;I am 1 of 2&quot;

&gt; mpi.close.Rslaves()
[1] 1
&gt; mpi.quit()
</pre></div>
</div>
</div>
<div class="section" id="output-file-from-job-script">
<h2>Output File from Job Script<a class="headerlink" href="#output-file-from-job-script" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The output shows messages that are errors</p></li>
<li><p>The messages seem not to have any effects to the output or execution
of the program</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#########################BEGIN-PROLOG#########################
JobId             = 6462
JobName           = hello_world_R
UserId            = username(20117)
GroupId           = username(20117)
Priority          = 837
Nice              = 0
Account           = admingrp
QOS               = normal
Requeue           = 1
Restarts          = 0
BatchFlag         = 1
Reboot            = 0
ExitCode          = 0:0
RunTime           = 00:00:00
TimeLimit         = 00:01:00
TimeMin           = N/A
SubmitTime        = 2015-09-15T10:36:31
EligibleTime      = 2015-09-15T10:36:31
StartTime         = 2015-09-15T10:36:31
EndTime           = 2015-09-15T10:37:31
Partition         = small
AllocNode:Sid     = headnode:12501
NodeList          = bc02bl03
BatchHost         = bc02bl03
NumNodes          = 1
NumCPUs           = 8
CPUs/Task         = 1
ReqB:S:C:T        = 0:0:*:*
Socks/Node        = *
NtasksPerN:B:S:C  = 8:0:*:*
CoreSpec          = *
MinCPUsNode       = 8
MinMemoryNode     = 15948M
MinTmpDiskNode    = 0
Command           = /home/username/slurm_examples/example_mpi_R.pbs.slurm
WorkDir           = /home/username/slurm_examples
StdErr            = /home/username/slurm_examples/slurm-6462.out
StdOut            = /home/username/slurm_examples/slurm-6462.out
###########################END-PROLOG#########################
--------------------------------------------------------------------------
Please check /var/log/messages or dmesg for driver specific failure
reason.
The failure occurred here:

  Local host:    mlx4_0
  Device:        openib_reg_mr
  Function:      Cannot allocate memory()
  Errno says:

You may need to consult with your system administrator to get this
problem fixed.
--------------------------------------------------------------------------
--------------------------------------------------------------------------
The OpenFabrics (openib) BTL failed to initialize while trying to
allocate some locked memory.  This typically can indicate that the
memlock limits are set too low.  For most HPC installations, the
memlock limits should be set to &quot;unlimited&quot;.  The failure occured
here:

  Local host:    bc02bl03.deac.wfu.edu
  OMPI source:   ../../../../../ompi/mca/btl/openib/btl_openib_component.c:1161
  Function:      ompi_free_list_init_ex_new()
  Device:        mlx4_0
  Memlock limit: 65536

You may need to consult with your system administrator to get this
problem fixed.  This FAQ entry on the Open MPI web site may also be
helpful:

    http://www.open-mpi.org/faq/?category=openfabrics#ib-locked-pages
--------------------------------------------------------------------------
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   bc02bl03.deac.wfu.edu
  Local device: mlx4_0
--------------------------------------------------------------------------
[bc02bl03.deac.wfu.edu:09281] 1 more process has sent help message help-mpi-btl-openib.txt / mem-reg-fail
[bc02bl03.deac.wfu.edu:09281] Set MCA parameter &quot;orte_base_help_aggregate&quot; to 0 to see all help / error messages
[bc02bl03.deac.wfu.edu:09281] 1 more process has sent help message help-mpi-btl-openib.txt / init-fail-no-mem
[bc02bl03.deac.wfu.edu:09281] 1 more process has sent help message help-mpi-btl-openib.txt / error in device init
[H^[[2J
</pre></div>
</div>
</div>
</div>
<div class="section" id="generate-more-processes">
<h1><em><strong>Generate More Processes</strong></em><a class="headerlink" href="#generate-more-processes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="rslave">
<h2>Rslave()<a class="headerlink" href="#rslave" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>As seen on the first example: only one process; aside from the
Master process, gets spawned</p></li>
<li><p>In order to generate more slave processes; the
<strong>mpi.spawn.Rslaves()</strong> function has to specify the desired number
of processes</p></li>
<li><p>This is done by changing line 6 to the following:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">mpi.spawn.Rslaves(</span></code><strong><code class="docutils literal notranslate"><span class="pre">nslaves=8</span></code></strong><code class="docutils literal notranslate"><span class="pre">)</span></code></p>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The output shows the process that were generated when executing the
<strong>mpi.spawn.Rslaves()</strong> function</p></li>
<li><p>The output finally shows the print out from each process:</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R version 3.1.0 (2014-04-10) -- &quot;Spring Dance&quot;
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-redhat-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type &#39;license()&#39; or &#39;licence()&#39; for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type &#39;contributors()&#39; for more information and
&#39;citation()&#39; on how to cite R or R packages in publications.

Type &#39;demo()&#39; for some demos, &#39;help()&#39; for on-line help, or
&#39;help.start()&#39; for an HTML browser interface to help.
Type &#39;q()&#39; to quit R.

&gt; library(Rmpi)
&gt;
&gt; if (!is.loaded(&quot;mpi_initialize&quot;)) {
+   library(&quot;Rmpi&quot;)
+ }
&gt; mpi.spawn.Rslaves(nslaves=8)
        8 slaves are spawned successfully. 0 failed.
master (rank 0, comm 1) of size 9 is running on: bc02bl03
slave1 (rank 1, comm 1) of size 9 is running on: bc02bl03
slave2 (rank 2, comm 1) of size 9 is running on: bc02bl03
slave3 (rank 3, comm 1) of size 9 is running on: bc02bl03
... ... ...
slave7 (rank 7, comm 1) of size 9 is running on: bc02bl03
slave8 (rank 8, comm 1) of size 9 is running on: bc02bl03
&gt;
&gt; .Last &lt;- function(){
+   if(is.loaded(&quot;mpi_initialize&quot;)) {
+     if(mpi.comm.size(1)&gt;0) {
+       print(&quot;Please use mpi.close.Rslave() to close slaves.&quot;)
+       mpi.close.Rslaves()
+     }
+     print(&quot;Please use mpi.quit() to quit R&quot;)
+     .Call(&quot;mpi_finalize&quot;)
+   }
+ }
&gt;
&gt; mpi.remote.exec(paste(&quot;I am&quot;,mpi.comm.rank(),&quot;of&quot;,mpi.comm.size()))
$slave1
[1] &quot;I am 1 of 9&quot;

$slave2
[1] &quot;I am 2 of 9&quot;

$slave3
[1] &quot;I am 3 of 9&quot;

$slave4
[1] &quot;I am 4 of 9&quot;

$slave5
[1] &quot;I am 5 of 9&quot;

$slave6
[1] &quot;I am 6 of 9&quot;

$slave7
[1] &quot;I am 7 of 9&quot;

$slave8
[1] &quot;I am 8 of 9&quot;

&gt; mpi.close.Rslaves()
[1] 1
&gt; mpi.quit()
</pre></div>
</div>
<p><a class="reference external" href="Category:Software">Category:Software</a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">DEAC Cluster Wiki</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Adam Carlson, Cody Stevens, Sean Anderson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/software/pending/R_-_Multiprocess_with_MPI.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>