
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>R Language &#8212; DEAC Cluster Wiki  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="r-language">
<h1><em><strong>R Language</strong></em><a class="headerlink" href="#r-language" title="Permalink to this headline">¶</a></h1>
<p><strong>forcetoc</strong></p>
<div class="section" id="description-info">
<h2>Description &amp; Info<a class="headerlink" href="#description-info" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The <a class="reference external" href="Software:RStudio">Software:RStudio</a> IDE can be used
on any head-node.</p></li>
<li><p>The <strong>foreach</strong>, <strong>iterators</strong> &amp; <strong>doParallel</strong> packages must be
installed. Same steps as the <a class="reference external" href="Software:RStudio#Installing_Packages_%27%27%27Rmpi%27%27%27_package_installation">Software:RStudio#Installing_Packages
<strong>Rmpi</strong> package
installation</a></p></li>
<li><p>Wikibook: <a class="reference external" href="http://en.wikibooks.org/wiki/R_Programming">R
Programming</a></p></li>
<li><p><a class="reference external" href="http://cran.r-project.org/web/views/HighPerformanceComputing.html">HPC with
R</a></p></li>
</ul>
</div>
</div>
<div class="section" id="testing-foreach-package">
<h1><em><strong>Testing foreach Package</strong></em><a class="headerlink" href="#testing-foreach-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="matrix-multiplication-with-foreach-package">
<h2>Matrix Multiplication with <em>foreach</em> Package<a class="headerlink" href="#matrix-multiplication-with-foreach-package" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Matrix multiplication is used to test the <strong>foreach</strong> package on the
cluster</p></li>
<li><p>The example was taken from <a class="reference external" href="http://cran.r-project.org/web/packages/foreach/foreach.pdf">foreach Cran
PDF</a></p></li>
<li><p>Template:</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># clears all global environment before starting program</span>
<span class="n">rm</span><span class="p">(</span><span class="nb">list</span> <span class="o">=</span> <span class="n">ls</span><span class="p">())</span>

<span class="c1"># List of libraries packages that must be included</span>
<span class="c1"># doParallel, iterators &amp; foreach have to be present</span>
<span class="n">library</span><span class="p">(</span><span class="n">foreach</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">iterators</span><span class="p">);</span> <span class="n">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span>

<span class="c1"># Before running parallel command, program must have</span>
<span class="c1"># a register parallel backend in order to run in parallel</span>
<span class="c1"># cl is a &#39;cluster&#39; object of 8 cores</span>
<span class="n">cl</span> <span class="o">&lt;-</span> <span class="n">makePSOCKcluster</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">registerDoParallel</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>

<span class="c1"># &#39;a&#39; is a 10x200,000 matrix with 2,000,000 random elements</span>
<span class="c1"># &#39;b&#39; is the transpose matrix of &#39;a&#39; - 200,000x10</span>
<span class="c1"># Resultant matrix of dim 10x10</span>
<span class="n">a</span> <span class="o">&lt;-</span> <span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="mi">2000000</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span><span class="mi">200000</span><span class="p">)</span>
<span class="n">b</span> <span class="o">&lt;-</span> <span class="n">t</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="c1"># For each iteration:</span>
<span class="c1"># Breaks down each column from &#39;b&#39; and multiply it by &#39;a&#39;</span>
<span class="c1"># The results are collected by .combine=cbind</span>
<span class="c1"># The %dopar% operator will generated the threads to execute in parallel</span>
<span class="c1"># The operation of multiplying must be also surrounded by the %-sign</span>
<span class="c1"># Otherwise, it will execute in serial mode</span>
<span class="n">foreach</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="nb">iter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">),</span> <span class="o">.</span><span class="n">combine</span><span class="o">=</span><span class="n">cbind</span><span class="p">)</span> <span class="o">%</span><span class="n">dopar</span><span class="o">%</span> <span class="p">(</span><span class="n">a</span> <span class="o">%*%</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># Good practice to close/kill the socket communication</span>
<span class="c1"># of all the workers by using the Cluster object &#39;cl&#39;</span>
<span class="n">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Output that gets generated should be a 10x10</p></li>
<li><p>Note: Each time this example runs, different element values will get
generated</p></li>
<li><p>Example of a possible
output:</p></li>
</ul>
<!-- end list --><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>             <span class="p">[,</span><span class="mi">1</span><span class="p">]</span>         <span class="p">[,</span><span class="mi">2</span><span class="p">]</span>          <span class="p">[,</span><span class="mi">3</span><span class="p">]</span>         <span class="p">[,</span><span class="mi">4</span><span class="p">]</span>        <span class="p">[,</span><span class="mi">5</span><span class="p">]</span>        <span class="p">[,</span><span class="mi">6</span><span class="p">]</span>        <span class="p">[,</span><span class="mi">7</span><span class="p">]</span>         <span class="p">[,</span><span class="mi">8</span><span class="p">]</span>          <span class="p">[,</span><span class="mi">9</span><span class="p">]</span>        <span class="p">[,</span><span class="mi">10</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">1</span><span class="p">,]</span> <span class="mf">199169.6015</span>    <span class="mf">794.22361</span>    <span class="mf">262.055677</span>    <span class="mf">283.99548</span>    <span class="mf">402.3996</span>   <span class="o">-</span><span class="mf">292.5005</span>   <span class="o">-</span><span class="mf">806.5746</span>     <span class="mf">35.48630</span>   <span class="o">-</span><span class="mf">208.976473</span>    <span class="mf">353.57920</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">,]</span>    <span class="mf">794.2236</span> <span class="mf">200880.89297</span>    <span class="mf">210.791207</span>    <span class="mf">285.83114</span>   <span class="o">-</span><span class="mf">336.8855</span>  <span class="o">-</span><span class="mf">1013.3063</span>   <span class="o">-</span><span class="mf">420.5574</span>     <span class="mf">82.13992</span>    <span class="mf">558.076190</span>    <span class="mf">343.20755</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">,]</span>    <span class="mf">262.0557</span>    <span class="mf">210.79121</span> <span class="mf">200157.047011</span>    <span class="mf">861.73804</span>   <span class="o">-</span><span class="mf">382.5887</span>   <span class="o">-</span><span class="mf">405.8085</span>    <span class="mf">577.7373</span>   <span class="o">-</span><span class="mf">599.35569</span>      <span class="mf">1.750347</span>    <span class="mf">383.42479</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">,]</span>    <span class="mf">283.9955</span>    <span class="mf">285.83114</span>    <span class="mf">861.738043</span> <span class="mf">200171.13075</span>   <span class="o">-</span><span class="mf">213.1187</span>    <span class="mf">541.8806</span>    <span class="mf">325.8889</span>   <span class="o">-</span><span class="mf">592.05285</span>    <span class="mf">596.271144</span>     <span class="mf">64.79383</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">,]</span>    <span class="mf">402.3996</span>   <span class="o">-</span><span class="mf">336.88554</span>   <span class="o">-</span><span class="mf">382.588695</span>   <span class="o">-</span><span class="mf">213.11870</span> <span class="mf">199209.6985</span>    <span class="mf">220.2736</span>    <span class="mf">250.3666</span>   <span class="o">-</span><span class="mf">246.30454</span>   <span class="o">-</span><span class="mf">265.334563</span>    <span class="mf">669.30438</span>
 <span class="p">[</span><span class="mi">6</span><span class="p">,]</span>   <span class="o">-</span><span class="mf">292.5005</span>  <span class="o">-</span><span class="mf">1013.30628</span>   <span class="o">-</span><span class="mf">405.808523</span>    <span class="mf">541.88058</span>    <span class="mf">220.2736</span> <span class="mf">200816.2702</span>   <span class="o">-</span><span class="mf">552.9066</span>   <span class="o">-</span><span class="mf">128.75266</span>   <span class="o">-</span><span class="mf">595.465460</span>    <span class="mf">454.24774</span>
 <span class="p">[</span><span class="mi">7</span><span class="p">,]</span>   <span class="o">-</span><span class="mf">806.5746</span>   <span class="o">-</span><span class="mf">420.55737</span>    <span class="mf">577.737350</span>    <span class="mf">325.88891</span>    <span class="mf">250.3666</span>   <span class="o">-</span><span class="mf">552.9066</span> <span class="mf">199313.6753</span>   <span class="o">-</span><span class="mf">175.09126</span>   <span class="o">-</span><span class="mf">413.613558</span>    <span class="mf">307.94146</span>
 <span class="p">[</span><span class="mi">8</span><span class="p">,]</span>     <span class="mf">35.4863</span>     <span class="mf">82.13992</span>   <span class="o">-</span><span class="mf">599.355688</span>   <span class="o">-</span><span class="mf">592.05285</span>   <span class="o">-</span><span class="mf">246.3045</span>   <span class="o">-</span><span class="mf">128.7527</span>   <span class="o">-</span><span class="mf">175.0913</span> <span class="mf">200700.25553</span>   <span class="o">-</span><span class="mf">476.442597</span>    <span class="mf">138.90606</span>
 <span class="p">[</span><span class="mi">9</span><span class="p">,]</span>   <span class="o">-</span><span class="mf">208.9765</span>    <span class="mf">558.07619</span>      <span class="mf">1.750347</span>    <span class="mf">596.27114</span>   <span class="o">-</span><span class="mf">265.3346</span>   <span class="o">-</span><span class="mf">595.4655</span>   <span class="o">-</span><span class="mf">413.6136</span>   <span class="o">-</span><span class="mf">476.44260</span> <span class="mf">200074.405654</span>   <span class="o">-</span><span class="mf">238.64176</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,]</span>    <span class="mf">353.5792</span>    <span class="mf">343.20755</span>    <span class="mf">383.424786</span>     <span class="mf">64.79383</span>    <span class="mf">669.3044</span>    <span class="mf">454.2477</span>    <span class="mf">307.9415</span>    <span class="mf">138.90606</span>   <span class="o">-</span><span class="mf">238.641757</span> <span class="mf">199055.30105</span>
</pre></div>
</div>
<p><a class="reference external" href="Category:Software">Category:Software</a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">DEAC Cluster Wiki</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Adam Carlson, Cody Stevens, Sean Anderson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/software/pending/R_-_Multiprocess_with_foreach.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>